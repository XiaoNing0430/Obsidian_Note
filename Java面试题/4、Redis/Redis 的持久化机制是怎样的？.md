
Redis 提供了两种持久化机制，分别是 RDB 和 AOF

# RDB

RDB 是将 Redis 的内存中的数据**定期**保存到磁盘上，以防止数据在 Redis 进程异常退出或服务器断点等情况下丢失。

**优点：快照文件小、恢复速度快、适合做备份和灾难容灾**
**缺点：定期更新可能会丢失数据**


# AOF

AOF 是将 Redis 的所有写操作**追加到AOF文件（Append Only File）的末尾**，从而记录了 Redis 服务器运行期间所有修改操作的详细记录。当 Redis 重新启动时，可以通过执行 AOF 文件中保存的写操作来恢复数据。

如果 Redis 刚刚执行完一个写命令，但没来得及写 AOF 文件就宕机了，那么这个命令和相应的数据就会丢失。

**优点：可以实现更高的数据可靠性、支持更细粒度的数据恢复，适合做数据存档和数据备份**
**缺点：文件大占用空间多，每次写操作都需要写磁盘导致负载较高**


# 混合持久化

AOF 和 RDB 各有优缺点，为了让用户能够同时拥有上述两种持久化的优点，Redis 4.0 推出了 RDB-AOF 持久化。

在开启混合持久化的情况下，AOF重写时会把 Redis 的持久化数据，以 RDB 的格式写入到 AOF 文件的开头，之后的数据再以 AOF 的格式追加到文件末尾

`aof-use-rdb-preamble` 是开启混合模式的参数

混合持久化结合了 RDB 和 AOF 优点，开头是 RDB 格式，使得 Redis 可以更快的启动，同时结合 AOF 的优点，减低大量丢失数据的风险。

但是，在 AOF 文件中添加了 RDB 格式的内容，使得 AOF 文件的**可读性变得很差**；如果开启混合持久化，那么此混合持久化 AOF 文件，不能用在旧版本，**不向下兼容的**。