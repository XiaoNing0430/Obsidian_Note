
# 自适应自旋
在 jdk6 之后的版本中，JVM引入了 **自适应自旋** 机制。该机制通过监控轻量级锁自旋等待的情况，动态调整自旋等待的事件。

如果自旋等待的时间很短，说明锁的竞争不激烈，当前线程可以自旋等待一段时间，避免线程挂起和恢复带来的性能损失。如果自旋等待的时间较长，说明锁的竞争比较激烈，当前线程应该即时释放 CPU 资源，让其他线程有机会执行。

自适应的自旋是现在 ObjectSynchronizer::FastHashCode() 函数中。改函数会根据轻量级锁自旋等待的情况，调整自旋等待的时间。


# 锁消除
在动态编译同步块时，JIT编译器可以借助逃逸分析（Escape Analysis）的技术来判断同步块所使用的锁对象是否只能够被一个线程访问而没有被发布到其他线程

如果同步块所使用的锁对象通过这种分析被证实只能够被一个线程访问，那么 JIT编译器在编译这个同步块的时候就会取消对这部分代码的同步


# 锁粗化
```java
for (int i = 0; i < 10000; i++) {
	synchronized(this) {
		do();
	}
}
```
会被粗化成
```java
synchronized(this) {
	for (int i = 0; i < 10000; i++) {
		do();
	}
}
```