
# 排他锁

**排他锁又称为写锁**，如果事务1对数据A加上排他锁后，则其他事务不能再对A加任何类型的锁。**获得排他锁的事务既能读数据，又能修改数据**

```mysql
SELECT ... FOR UPDATE;
```

在查询语句后面增加 FOR UPDATE，MySQL会对查询命中的每条记录都加排他锁（在有索引的情况下通过索引加锁，无索引时会锁表），当没有其他线程对查询结果命中的任何一行使用排他锁时，可以成功申请排他锁，否则会被阻塞


# 共享锁

**共享锁又称读锁，是读取操作创建的锁**。其他用户可以并发读取数据，但任何事务都不能对数据进行修改（获取数据上的排他锁），直到已释放所有共享锁

如果事务1对数据A加上共享锁，则其他事务只能对A再加共享锁，不能加排他锁。**获得共享锁的事务只能读数据，不能修改数据**

```mysql
SELECT ... LOCK IN SHARE MODE;
```

在查询语句后面增加 `LOCK IN SHARE MODE`，MySQL会对查询命中的每条记录都加共享锁（在有索引的情况下通过索引加锁，无索引时会锁表），当没有其他线程对查询结果命中的任何一行使用排他锁时，可以成功申请共享锁，否则会被阻塞。其他事务也可以读取使用了共享锁的表，而且这些事务读取的是同一个版本的数据


# 意向锁

**意向锁是数据库管理系统中用于实现锁协议的一种锁机制，旨在处理不同锁粒度（如行锁和表锁）之间的并发性问题**。（相同锁粒度之间的并发性问题通过行级互斥锁解决）

1. 意向锁并不是直接锁定资源，而是为了通知其他事务，以防止它们在资源上设置不兼容的锁
2. 意向锁并不是直接由用户请求的，而是由MySQL管理的

**当一个事务请求获取一个行级锁或表级锁时，MySQL会自动获取相应的意向锁**。这样，其他事务请求获取表锁时，可以先基于这个意向锁来发现是否有人加过锁，并根据该锁的类型（意向共享锁/意向排他锁）来判断自己是否可以获取锁。这样可以在不阻塞其他事务的情况下，为当前事务锁定资源。

意向锁有两种类型：意向共享锁、意向排他锁
1. **意向共享锁**：表示事务打算在资源上设置共享锁（读锁）。这通常用于表示事务计划读取资源，并不希望读取时有其他事务设置排他锁
2. **意向排他锁**：表示事务打算在资源上设置排他锁（写锁）。这通常用于表示事务计划修改资源，并不希望有其他事务同时设置共享锁或者排他锁

**意向锁是一个表级锁，并且会在触发意向锁的事务提交或者回滚后释放**